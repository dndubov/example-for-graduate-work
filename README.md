# Backend-сервис объявлений (SkyPro)

## Описание проекта

Проект представляет собой backend-приложение для сервиса объявлений с поддержкой пользователей, объявлений, комментариев и загрузки изображений.

Приложение реализовано на Spring Boot и предоставляет REST API для работы с шаблонным фронтендом SkyPro.

Реализованы:
- регистрация и аутентификация пользователей;
- управление профилем пользователя;
- работа с объявлениями;
- комментарии к объявлениям;
- загрузка и выдача изображений.

---

## Архитектура проекта

Проект построен по классической многослойной архитектуре:

Controller -> Service -> Repository -> Database
|
Mapper / DTO
|
ImageService (FS)


Слои:
- Controller — REST-эндпоинты;
- Service — бизнес-логика;
- Repository — доступ к БД;
- DTO — объекты передачи данных клиенту;
- Mapper — преобразование Entity ↔ DTO;
- ImageService — работа с файлами изображений;
- Security — аутентификация и контроль доступа.

---

## Структура пакетов

config/
WebSecurityConfig

filter/
BasicAuthCorsFilter

controller/
AuthController
UserController
ImageController
AdsController
AdImageController
CommentController

service/
UserService
AdService
CommentService
ImageService
AuthServiceImpl

repository/
UserRepository
AdRepository
CommentRepository

model/
UserEntity
AdEntity
CommentEntity

dto/
User
UpdateUser
Register
Login
Role
NewPassword
Ad
ExtendedAd
CreateOrUpdateAd
Ads
Comment
CreateOrUpdateComment
Comments


---

## Пользователи

Реализованы:
- регистрация и аутентификация;
- получение и обновление профиля;
- смена пароля;
- загрузка аватара пользователя.

### Аватар пользователя

- POST /users/me/image — загрузка аватара (multipart/form-data)
- GET /users/{id}/image — получение изображения пользователя

В базе данных хранится путь к файлу изображения.  
В API клиенту передаётся URL вида `/users/{id}/image`.

---

## Объявления

Реализованы:
- получение списка объявлений;
- получение одного объявления;
- создание, редактирование и удаление объявлений;
- загрузка изображений объявлений.

### Формат списка объявлений

```json
{
  "count": 1,
  "results": [
    {
      "pk": 1,
      "title": "Объявление",
      "price": 100,
      "author": 1,
      "image": "/ads/1/image"
    }
  ]
}
```
## Изображения объявлений

- `GET /ads/{id}/image` — получение изображения объявления;
- изображения объявлений сохраняются в файловой системе;
- в базе данных хранится только путь к файлу;
- клиенту отдаётся публичный URL.

---

## Комментарии

Поддерживаются:

- получение списка комментариев;
- добавление комментариев;
- редактирование и удаление комментариев;
- проверка прав доступа (автор или администратор).

---

## Безопасность

- используется Spring Security;
- аутентификация через Basic Auth;
- защищённые эндпоинты доступны только авторизованным пользователям;
- настроен CORS для работы с фронтендом.

---

## Особенности шаблонного фронтенда

Загрузка аватара пользователя корректно реализована на стороне бэкенда и протестирована через Postman.

Шаблонный фронтенд SkyPro не отправляет запрос  
`POST /users/me/image` при выборе файла, что подтверждается отсутствием POST-запроса в DevTools → Network.

По этой причине смена аватара через UI не происходит, несмотря на корректную серверную реализацию.

---

## Тестирование

API тестировалось с использованием Postman.

Корректность работы подтверждена:

- изменением данных в базе данных;
- корректными HTTP-ответами;
- успешной выдачей изображений.

---

## Используемые технологии

- Java 17
- Spring Boot
- Spring Security
- Spring Data JPA
- PostgreSQL
- MapStruct
- Maven

---

## Итог

Проект реализует полный набор серверной логики сервиса объявлений и соответствует требованиям задания.

Ограничения, связанные со сменой аватара через пользовательский интерфейс, обусловлены особенностями шаблонного фронтенда.

