# Площадка для перепродажи вещей (Backend)

## Описание

Это backend-часть веб-приложения для перепродажи вещей. Проект предоставляет REST API для управления объявлениями, комментариями и профилями пользователей. Поддерживает регистрацию, аутентификацию, разграничение прав (пользователь/администратор), CRUD-операции над объявлениями и комментариями, а также работу с изображениями объявлений и аватарками пользователей.

## Технологии

*   **Java 17+**: Язык программирования.
*   **Spring Boot 3.x**: Фреймворк для создания standalone приложений.
*   **Spring Web**: Для создания REST API.
*   **Spring Data JPA**: Для работы с базой данных.
*   **Spring Security**: Для аутентификации и авторизации.
*   **Liquibase**: Для миграции базы данных.
*   **Docker**: Для управления контейнерами
*   **MapStruct**: Для генерации кода маппинга между DTO и сущностями.
*   **PostgreSQL**: Реляционная база данных.
*   **Maven / Gradle**: Система сборки проекта.
*   **JUnit 5 / Mockito**: Для модульного и интеграционного тестирования (предполагается наличие).

## Архитектура

Проект следует шаблону MVC и слоистой архитектуре:
*   **Controllers**: Обрабатывают HTTP-запросы, валидируют входные данные и вызывают сервисы.
*   **Services**: Содержат бизнес-логику приложения (CRUD, проверки прав доступа).
*   **Repositories**: Обеспечивают взаимодействие с базой данных.
*   **Entities**: Модели, отражающие структуру таблиц БД.
*   **DTO (Data Transfer Objects)**: Объекты, используемые для передачи данных между слоями (например, между контроллером и клиентом).
*   **Mappers**: Преобразуют DTO в сущности и обратно (реализовано с помощью MapStruct).

## Безопасность

*   Аутентификация и авторизация реализованы с помощью Spring Security.
*   Используется `BCrypt` для хеширования паролей.
*   Разграничение ролей: `USER` (обычный пользователь) и `ADMIN` (администратор).
*   Права доступа проверяются как на уровне `SecurityFilterChain`, так и внутри сервисов для операций, зависящих от ID сущности.

## Запуск проекта


1. Убедитесь, что у вас установлены Java 17+, Maven/Gradle и PostgreSQL (или H2 для тестов).
2. Склонируйте репозиторий:
    ```bash
    git clone <https://github.com/dndubov/example-for-graduate-work>
    cd <avito_clone_platform>
    ```
3. Настройте `application.properties` или `application.yml` для подключения к базе данных (например, `spring.datasource.url`, `spring.datasource.username`, `spring.datasource.password`).
4. Соберите проект:
    ```bash
    mvn clean install # для Maven
    # или
    ./gradlew build   # для Gradle
    ```
    
5. Запустите приложение:
    ```bash
    mvn spring-boot:run # для Maven
    # или
    ./gradlew bootRun   # для Gradle
    ```
6. Приложение будет доступно по адресу `http://localhost:8080` (по умолчанию).
7. Для проекта платформы по перепродаже вещей создана фронтенд-часть сайта. Front разворачивается в Docker контейнере.
   Для установки Docker на ваш компьютер нужно установить Docker Desktop:
   https://www.docker.com/products/docker-desktop/.
   Чтобы запустить фронтенд с помощью установленного Docker, нужно открыть командную строку (или терминал) и выполнить следующую команду:
   docker run -p 3000:3000 --rm ghcr.io/dmitry-bizin/front-react-avito:v1.21
   После выполнения команды frontend запустится на порту 3000 и можно будет зайти на него через браузер по адресу: http://localhost:3000

## API Endpoints

Примеры:
*   `POST /register` - Регистрация пользователя.
*   `POST /login` - Аутентификация пользователя.
*   `GET /ads` - Получить все объявления.
*   `POST /ads` - Создать объявление (требует аутентификации).
*   `GET /ads/{id}` - Получить объявление по ID.
*   `PATCH /ads/{id}` - Обновить объявление (владелец или админ).
*   `DELETE /ads/{id}` - Удалить объявление (владелец или админ).
*   `GET /ads/{id}/comments` - Получить комментарии к объявлению.
*   `POST /ads/{id}/comments` - Добавить комментарий (требует аутентификации).
*   `PATCH /ads/{adId}/comments/{commentId}` - Обновить комментарий (владелец или админ).
*   `DELETE /ads/{adId}/comments/{commentId}` - Удалить комментарий (владелец или админ).
*   `GET /users/me` - Получить информацию о текущем пользователе.
*   `PATCH /users/me` - Обновить информацию о текущем пользователе.
*   `PATCH /users/me/image` - Обновить аватар текущего пользователя.
*   `POST /users/set_password` - Изменить пароль текущего пользователя.

Подробнее см. OpenAPI спецификацию в `src/main/resources/openapi.yaml`
